#!/usr/bin/env ruby

require 'optparse'
require 'methadone'
require 'clean_filenames.rb'

class App
  include Methadone::Main
  include Methadone::CLILogging

  main do

    logger.level=Logger::INFO
    logger.level=Logger::ERROR if options[:quiet]
    logger.error_level=Logger::DEBUG if options[:debug]
    
    debug "options: #{options.inspect}"

    ARGV.uniq!
    debug "ARGV: #{ARGV.inspect}"

    puts CleanFilenames.convert(ARGV, options)
  end

  description "Convert path names to clean path names"

  options["ignore-levels"] == 0
  on("-i IGNORE_LEVEL","--ignore-levels", "Number of levels in beginning of PATH_NAME to ignore")

  on("-n","--dry-run", "show what would change, but don't change it")
  on("-d","--[no-]debug","turn on [off] debug")
  on("-q","--quiet","be very quiet (only error output)")

  arg :path_name, "Path name to convert"

  version CleanFilenames::VERSION

  leak_exceptions(true)
  go!
end
